<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fishing Archipelago</title>
<style>
 body{font-family:system-ui;padding:14px;background:linear-gradient(#e6f7ff,#f9fff8)}
 .layout{display:grid;grid-template-columns:360px 1fr 320px;gap:12px}
 .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
 button{padding:8px;border-radius:6px;border:1px solid #ddd;background:#fff}
 .log{height:140px;overflow:auto;font-family:monospace}
</style>
</head><body>
<h1>üé£ Fishing Archipelago</h1>
<div class="layout">
  <aside class="card">
    <h3>Dock</h3>
    <div>Gold: <strong id="gold">0</strong></div>
    <div>Bait: <span id="bait">0</span></div>
    <div>Boat Level: <span id="boat">1</span></div>
    <hr/>
    <button id="buyBait">Buy Bait (1g)</button>
    <button id="upgradeBoat">Upgrade Boat (50g)</button>
    <hr/>
    <button id="save">Save</button><button id="export">Export</button><input id="importFile" type="file" accept="application/json" style="display:none"/><button id="importBtn">Import</button>
    <hr/>
    <div><button id="toggleDebug">Toggle Debug</button><div id="debug" style="display:none"><button id="cheatGold">+1000</button></div></div>
  </aside>

  <main class="card">
    <h3>Choose Spot</h3>
    <select id="spotSelect"></select>
    <button id="goFish">Cast Line</button>
    <div style="margin-top:10px">Reel meter: <progress id="reel" value="0" max="100" style="width:100%"></progress></div>
    <h4 style="margin-top:10px">Catches</h4>
    <ul id="catches"></ul>
  </main>

  <aside class="card">
    <h3>Info & Log</h3>
    <div id="log" class="log"></div>
    <hr/>
    <h4>Trophies</h4>
    <div id="trophies"></div>
  </aside>
</div>

<script>
/* Simple API */
const Game = {
  key:'fish_v1',
  init(){ if(!localStorage.getItem(this.key)) localStorage.setItem(this.key, JSON.stringify(this.state)); else this.load(); },
  save(){ localStorage.setItem(this.key, JSON.stringify(this.state)); log('Saved'); },
  load(){ const s=localStorage.getItem(this.key); if(s) this.state = JSON.parse(s); },
  export(){ const raw = localStorage.getItem(this.key); if(!raw) return alert('No save'); const blob=new Blob([raw],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='fish_save.json'; a.click(); URL.revokeObjectURL(url); },
  import(file,cb){ const r=new FileReader(); r.onload=e=>{ try{ localStorage.setItem(this.key,e.target.result); this.load(); if(cb)cb(true);}catch(e){if(cb)cb(false);} }; r.readAsText(file); }
};

/* state */
Game.state = {
  gold: 30,
  bait: 5,
  boat:1,
  spots: [
    {id:'lagoon',name:'Calm Lagoon',chance:0.8,rarity:[{name:'Small Fish',val:5},{name:'Silver Fish',val:12}],minBait:1},
    {id:'reef',name:'Coral Reef',chance:0.6,rarity:[{name:'Reef Trout',val:20},{name:'Hidden Snapper',val:45}],minBait:2},
    {id:'deep',name:'Deep Sea',chance:0.4,rarity:[{name:'Abyssal Tuna',val:80},{name:'Golden Marlin',val:220}],minBait:3}
  ],
  catches: [],
  trophies:{}
};
Game.init();

/* UI */
const $ = id=>document.getElementById(id);
function log(msg){ $('log').innerHTML = new Date().toLocaleTimeString() + ' ‚Äî ' + msg + '<br/>' + $('log').innerHTML; }
function render(){
  $('gold').textContent = Game.state.gold;
  $('bait').textContent = Game.state.bait;
  $('boat').textContent = Game.state.boat;
  const sel = $('spotSelect'); sel.innerHTML='';
  Game.state.spots.forEach(s=>{ const o=document.createElement('option'); o.value=s.id; o.text=s.name; sel.add(o); });
  const list = $('catches'); list.innerHTML=''; Game.state.catches.forEach(c=>{ const li = document.createElement('li'); li.textContent = `${c.name} ‚Äî ${c.value}g`; list.appendChild(li); });
  const t = $('trophies'); t.innerHTML = Object.keys(Game.state.trophies).map(k=>`<div>${k} üèÜ</div>`).join('') || 'None';
}
render();

/* actions */
$('buyBait').onclick = ()=>{ if(Game.state.gold < 1) return alert('No gold'); Game.state.gold -=1; Game.state.bait +=1; Game.save(); render(); }
$('upgradeBoat').onclick = ()=>{ if(Game.state.gold < 50) return alert('No gold'); Game.state.gold -=50; Game.state.boat +=1; Game.save(); render(); }
$('save').onclick = ()=>{ Game.save(); alert('Saved'); };
$('export').onclick = ()=>Game.export();
$('importBtn').onclick = ()=>$('importFile').click();
$('importFile').onchange = (e)=>{ const f = e.target.files[0]; if(!f) return; Game.import(f, ok=>{ if(ok) render(); else alert('Import failed'); }); };
$('toggleDebug').onclick = ()=>{ const d=$('debug'); d.style.display = d.style.display==='none'?'block':'none'; };
$('cheatGold').onclick = ()=>{ Game.state.gold += 1000; render(); Game.save(); };

/* fishing mechanic - simple reel minigame */
let reelInterval=null;
$('goFish').onclick = ()=>{
  const spotId = $('spotSelect').value;
  const spot = Game.state.spots.find(s=>s.id===spotId);
  if(Game.state.bait < spot.minBait) return alert('Not enough bait for this spot');
  Game.state.bait -= spot.minBait; render();
  log('Casting to '+spot.name+'...');
  let progress = 0;
  $('reel').value = 0;
  reelInterval = setInterval(()=>{
    // progress increases slowly; user must press space or click to "reel" at right time
    progress += 4 + Game.state.boat;
    $('reel').value = progress;
    if(progress >= 100){
      clearInterval(reelInterval);
      const success = Math.random() < spot.chance + (Game.state.boat * 0.03);
      if(success){
        // pick rarity
        const pool = spot.rarity;
        const pick = pool[Math.floor(Math.random()*pool.length)];
        Game.state.catches.unshift({name:pick.name,value:pick.val});
        Game.state.gold += pick.val;
        log('Caught '+pick.name+' for '+pick.val+'g');
        if(pick.val >= 200) Game.state.trophies[pick.name] = true;
      } else {
        log('Nothing got hooked.');
      }
      Game.save(); render();
    }
  },120);
};

/* simple sell mechanic */
document.addEventListener('dblclick', (e)=>{
  // double-click catches list to sell all
});
/* right-click to sell single catch in UI */
$('catches').addEventListener('click', (ev)=>{
  const idx = Array.from($('catches').children).indexOf(ev.target);
  if(idx===-1) return;
  const c = Game.state.catches[idx];
  if(!c) return;
  if(confirm('Sell '+c.name+' for '+c.value+'g?')){ Game.state.gold += c.value; Game.state.catches.splice(idx,1); Game.save(); render(); }
});

/* auto events: tournaments */
setInterval(()=>{
  if(Math.random() < 0.03){
    // tournament appears at random spot
    const spot = Game.state.spots[Math.floor(Math.random()*Game.state.spots.length)];
    log('Tournament at '+spot.name+'! Prize 500g');
    // simple: if player catches a trophy (value>100) within next minute, he wins ‚Äî omitted due to time
  }
}, 5000);

log('Welcome! Double-click a catch to sell, or click a catch to sell individually.');
</script>
</body>
</html>
